import { createServer } from 'http';
import { Server } from 'socket.io';

let messages = [];

const PORT = process.env.PORT || 3001; // Render sets PORT automatically
const httpServer = createServer();

const io = new Server(httpServer, {
  cors: {
    origin: '*', // allows other frontends to connect
  }
});

io.on('connection', (socket) => {
  console.log('User connected:', socket.id);
  socket.emit('chatHistory', messages);

  socket.on('message', (msg) => {
    messages.push(msg);
    console.log('Received message:', msg);
    io.emit('message', msg); // broadcast to everyone
    
    const msgWithTime = { // adds timestamp to msg
      ...msg,           
      time: Date.now()
    
    };
    console.log('Received message with time', msgWithTime);
    io.emit('message', msgWithTime);

   });
});

httpServer.listen(PORT, () => {
  console.log('Server listening on ${PORT}');
});

//░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
//░░░░░░░▄▄▄▄▄▄░░░░░░░░░░░░░░░░░░░
//░░░░░▄█████████▄▄░░░░░░░░▄▄░░░░░
//░░░░███████████████▄▄░░░░▄██▄░░░
//░░░▄█████████████████████████░░░
//░▄██████████████████████████▀░░░
//░███░░░░░░░░░░░░░░░░░░░█░░░░░░░░
//░███░███████████████████░░░░░░░░
//░███░░▀████───████────█▀░░░░░░░░
//░███░░░▀▄▄▄▄▄▀░▀▄▄▄▄▄▀▀▀▄░░░░░░░
//░░██░░░░░░░░░░░░░░░░░░░░░▀▄░░░░░
//░░▄█░░░░░▄▀█▀▀▀▄▄▄░░░░░▄▀░░▀▄░░░
//░█░░░░░▄▀──█───█──▀█▄▄░▀▀░░░░▀▄░
//░▀▄▄░░█────█───█───█──▀▀▄░░▄▀▀▀░
//░░░█░██▄▄▄▄█▄▄▄█▄▄▄█▄▄▄▄▄█▄▄▀░░░
//░░░█░█████████████▄▄░░░░░░░░░░░░
//░░░█░█████████████████████████▄░
//░░░█░███████████████▀▀░░░░░░░░█░
//░░░█░██████████▀▀░░░░░░░░░░░░░█░
//░░░█░██████▀░░░░░░░░░░░░░░░░░░█░
//░░░█░███▀░░░░░░░░░░░░░░░░░░░░░█░
//░░░█░█▀░░░░░░░░░░░░░░░░░░░░░░░█░
//░░░█░░░░░░░░░░░░░░▀▄░▀▄░░░░░░░█░
//░░░█░░░░░░░░░░░░▄▄▄▀▄▄▀░░░░░░░█░
//░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░█░
//░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░█░
//░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░█░
//░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░█░
//░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░█░
//░░░█░░░░░░░░░░░░░░░░░░░░░░░░░░█░
//░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
//░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
//░█▀▄░█░█▄░█░█░█░█░░█▀░█▀▄░█▀░█▀▄░▄▀▀░█░
//░█░█░█░█▀██░█▀▄░█░░█▀░█▀▄░█▀░█▀▄░█░█░▀░
//░▀▀░░▀░▀░░▀░▀░▀░▀▀░▀▀░▀▀░░▀▀░▀░▀░░▀▀░▀░
//░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░